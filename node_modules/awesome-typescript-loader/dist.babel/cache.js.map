{"version":3,"sources":["../dist/cache.js"],"names":[],"mappings":"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","file":"cache.js","sourcesContent":["\"use strict\";\nconst fs = require('fs');\nconst crypto = require('crypto');\nconst os = require('os');\nconst path = require('path');\nconst zlib = require('zlib');\nfunction findCompiledModule(fileName) {\n    let baseFileName = fileName.replace(/(\\.ts|\\.tsx)$/, '');\n    let compiledFileName = `${baseFileName}.js`;\n    if (fs.existsSync(compiledFileName)) {\n        let mapFileName = `${baseFileName}.js.map`;\n        let isMapExists = fs.existsSync(mapFileName);\n        let result = {\n            fileName: compiledFileName,\n            text: fs.readFileSync(compiledFileName).toString(),\n            mapName: isMapExists\n                ? mapFileName\n                : null,\n            map: isMapExists\n                ? fs.readFileSync(mapFileName).toString()\n                : null\n        };\n        return result;\n    }\n    else {\n        return null;\n    }\n}\nexports.findCompiledModule = findCompiledModule;\nfunction read(filename, callback) {\n    return fs.readFile(filename, function (err, data) {\n        if (err) {\n            return callback(err);\n        }\n        return zlib.gunzip(data, function (err, content) {\n            let result = {};\n            if (err) {\n                return callback(err);\n            }\n            try {\n                result = JSON.parse(content);\n            }\n            catch (e) {\n                return callback(e);\n            }\n            return callback(null, result);\n        });\n    });\n}\n;\nfunction write(filename, result, callback) {\n    let content = JSON.stringify(result);\n    return zlib.gzip(content, function (err, data) {\n        if (err) {\n            return callback(err);\n        }\n        return fs.writeFile(filename, data, callback);\n    });\n}\n;\nfunction filename(source, identifier, options) {\n    let hash = crypto.createHash('sha512');\n    let contents = JSON.stringify({\n        identifier: identifier,\n        options: options,\n        source: source,\n    });\n    hash.end(contents);\n    return hash.read().toString('hex') + '.json.gzip';\n}\n;\nfunction cache(params, callback) {\n    let source = params.source;\n    let options = params.options || {};\n    let transform = params.transform;\n    let identifier = params.identifier;\n    let directory = (typeof params.directory === 'string') ?\n        params.directory :\n        os.tmpdir();\n    let file = path.join(directory, filename(source, identifier, options));\n    return read(file, function (err, content) {\n        let result = {};\n        if (!err) {\n            return callback(null, content);\n        }\n        try {\n            result = transform(source, options);\n        }\n        catch (error) {\n            return callback(error);\n        }\n        return write(file, result, function (err) {\n            return callback(err, result);\n        });\n    });\n}\nexports.cache = cache;\n;\n//# sourceMappingURL=cache.js.map"]}