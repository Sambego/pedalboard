{"version":3,"sources":["../../dist/test/utils.js"],"names":[],"mappings":"AAAA;;AACA,IAAM,OAAO,QAAQ,MAAR,CAAP;AACN,IAAM,KAAK,QAAQ,IAAR,CAAL;AACN,IAAM,IAAI,QAAQ,QAAR,CAAJ;AACN,QAAQ,gBAAR;AACA,QAAQ,oBAAR,EAA8B,OAA9B;AACA,IAAM,SAAS,QAAQ,MAAR,CAAT;AACN,QAAQ,MAAR,GAAiB,OAAO,MAAP;AACjB,IAAM,UAAU,QAAQ,SAAR,CAAV;AACN,IAAM,WAAW,QAAQ,UAAR,CAAX;AACN,IAAM,SAAS,SAAS,SAAT,CAAmB,QAAQ,QAAR,CAAnB,CAAT;AACN,IAAM,SAAS,SAAS,SAAT,CAAmB,QAAQ,QAAR,CAAnB,CAAT;AACN,IAAM,WAAW,SAAS,SAAT,CAAmB,GAAG,QAAH,CAA9B;AACN,IAAM,YAAY,SAAS,SAAT,CAAmB,GAAG,SAAH,CAA/B;AACN,IAAM,YAAY,KAAK,IAAL,CAAU,QAAQ,GAAR,EAAV,EAAyB,YAAzB,CAAZ;AACN,IAAM,oBAAoB,QAAQ,SAAR,EAAmB,iBAAnB;AAC1B,QAAQ,gBAAR,GAA2B,KAAK,IAAL,CAAU,QAAQ,GAAR,EAAV,EAAyB,KAAzB,EAAgC,MAAhC,EAAwC,QAAxC,CAA3B;AACA,QAAQ,kBAAR,GAA6B,KAAK,IAAL,CAAU,QAAQ,GAAR,EAAV,EAAyB,KAAzB,EAAgC,MAAhC,EAAwC,UAAxC,CAA7B;AACA,IAAI,iBAAiB;AACjB,kBAAc,EAAd;AACA,WAAO,KAAP;AACA,iBAAa,KAAb;CAHA;AAKJ,SAAS,YAAT,CAAsB,IAAtB,EAAuD;QAA3B,iEAAW,8BAAgB;;AACnD,QAAI,UAAU,EAAE,KAAF,CAAQ,EAAR,EAAY,cAAZ,EAA4B,QAA5B,CAAV,CAD+C;AAEnD,QAAM,gBAAgB;AAClB,eAAO,KAAP;AACA,gBAAQ;AACJ,kBAAM,QAAQ,gBAAR;AACN,sBAAU,WAAV;SAFJ;AAIA,iBAAS;AACL,wBAAY,CAAC,EAAD,EAAK,KAAL,EAAY,MAAZ,EAAoB,KAApB,EAA2B,MAA3B,CAAZ;SADJ;AAGA,gBAAQ;AACJ,qBAAS,CACL;AACI,sBAAM,eAAN;AACA,wBAAQ,YAAY,aAAZ,GAA4B,QAAQ,YAAR;aAHnC,CAAT;SADJ;AAQA,iBAAS,EAAT;KAjBE,CAF6C;AAqBnD,QAAI,QAAQ,OAAR,EAAiB;AACjB,sBAAc,MAAd,CAAqB,OAArB,CAA6B,CAA7B,EAAgC,OAAhC,GAA0C,QAAQ,OAAR,CADzB;KAArB;AAGA,QAAI,QAAQ,OAAR,EAAiB;AACjB,sBAAc,MAAd,CAAqB,OAArB,CAA6B,CAA7B,EAAgC,OAAhC,GAA0C,QAAQ,OAAR,CADzB;KAArB;AAGA,QAAI,QAAQ,KAAR,EAAe;AACf,sBAAc,KAAd,GAAsB,IAAtB,CADe;KAAnB;AAGA,QAAI,QAAQ,WAAR,EAAqB;AACrB,sBAAc,OAAd,CAAsB,IAAtB,CAA2B,IAAI,iBAAJ,EAA3B,EADqB;KAAzB;AAGA,WAAO,EAAE,KAAF,CAAQ,aAAR,EAAuB,IAAvB,CAAP,CAjCmD;CAAvD;AAmCA,QAAQ,YAAR,GAAuB,YAAvB;AACA,SAAS,YAAT,CAAsB,MAAtB,EAA8B,QAA9B,EAAwC;AACpC,WAAO,MAAP,CAAc,OAAO,OAAP,CAAe,KAAf,EAAsB,EAAtB,CAAd,EAAyC,OAAzC,CAAiD,SAAS,OAAT,CAAiB,KAAjB,EAAwB,EAAxB,CAAjD,EADoC;CAAxC;AAGA,QAAQ,YAAR,GAAuB,YAAvB;AACA,SAAS,WAAT,CAAqB,QAArB,EAAyE;QAA1C,oEAAc,QAAQ,kBAAR,gBAA4B;;AACrE,WAAO,KAAK,IAAL,CAAU,KAAV,CAAgB,IAAhB,EAAsB,CAAC,WAAD,EAAc,MAAd,CAAqB,QAArB,CAAtB,CAAP,CADqE;CAAzE;AAGA,QAAQ,WAAR,GAAsB,WAAtB;AACA,SAAS,WAAT,CAAqB,QAArB,EAAyE;QAA1C,oEAAc,QAAQ,kBAAR,gBAA4B;;AACrE,QAAI,WAAW,YAAY,QAAZ,EAAsB,WAAtB,CAAX,CADiE;AAErE,WAAO,SAAS,QAAT,EAAmB,IAAnB,CAAwB;eAAO,IAAI,QAAJ;KAAP,CAA/B,CAFqE;CAAzE;AAIA,QAAQ,WAAR,GAAsB,WAAtB;AACA,SAAS,YAAT,CAAsB,QAAtB,EAAgC,IAAhC,EAAgF;QAA1C,oEAAc,QAAQ,kBAAR,gBAA4B;;AAC5E,QAAI,WAAW,YAAY,QAAZ,EAAsB,WAAtB,CAAX,CADwE;AAE5E,WAAO,UAAU,QAAV,EAAoB,IAApB,CAAP,CAF4E;CAAhF;AAIA,QAAQ,YAAR,GAAuB,YAAvB;AACA,SAAS,SAAT,CAAmB,QAAnB,EAA6B;AACzB,WAAO,SAAS,QAAT,EACF,IADE,CACG;eAAO,IAAI,QAAJ;KAAP,CADH,CAEF,IAFE,CAEG;eAAU,UAAU,QAAV,EAAoB,MAApB;KAAV,CAFV,CADyB;CAA7B;AAKA,QAAQ,SAAR,GAAoB,SAApB;AACA,SAAS,cAAT,CAAwB,QAAxB,EAAwE;QAAtC,kEAAY,QAAQ,gBAAR,gBAA0B;;AACpE,WAAO,KAAK,IAAL,CAAU,QAAQ,gBAAR,EAA0B,QAApC,CAAP,CADoE;CAAxE;AAGA,QAAQ,cAAR,GAAyB,cAAzB;AACA,SAAS,cAAT,CAAwB,QAAxB,EAAwE;QAAtC,kEAAY,QAAQ,gBAAR,gBAA0B;;AACpE,WAAO,SAAS,eAAe,YAAY,SAAZ,EAAuB,SAAtC,CAAT,EAA2D,IAA3D,CAAgE;eAAO,IAAI,QAAJ;KAAP,CAAvE,CADoE;CAAxE;AAGA,QAAQ,cAAR,GAAyB,cAAzB;AACA,SAAS,cAAT,GAA8D;QAAtC,kEAAY,QAAQ,gBAAR,gBAA0B;;AAC1D,WAAO,OAAO,SAAP,EACF,IADE,CACG;eAAM,OAAO,SAAP;KAAN,CADV,CAD0D;CAA9D;AAIA,QAAQ,cAAR,GAAyB,cAAzB;AACA,SAAS,eAAT,CAAyB,MAAzB,EAAuE;QAAtC,kEAAY,QAAQ,gBAAR,gBAA0B;;AACnE,WAAO,eAAe,SAAf,EACF,IADE,CACG;eAAM,QAAQ,MAAR;KAAN,CADV,CADmE;CAAvE;AAIA,QAAQ,eAAR,GAA0B,eAA1B;AACA,SAAS,OAAT,CAAiB,MAAjB,EAAyB;AACrB,WAAO,IAAI,OAAJ,CAAY,UAAC,OAAD,EAAU,MAAV,EAAqB;AACpC,YAAI,WAAW,QAAQ,MAAR,CAAX,CADgC;AAEpC,iBAAS,GAAT,CAAa,UAAC,GAAD,EAAM,KAAN,EAAgB;AACzB,gBAAI,GAAJ,EAAS;AACL,uBAAO,GAAP,EADK;aAAT,MAGK;AACD,wBAAQ,KAAR,EADC;aAHL;SADS,CAAb,CAFoC;KAArB,CAAnB,CADqB;CAAzB;AAaA,QAAQ,OAAR,GAAkB,OAAlB;AACA,SAAS,KAAT,CAAe,MAAf,EAAuB,EAAvB,EAA2B;AACvB,QAAI,WAAW,QAAQ,MAAR,CAAX,CADmB;AAEvB,WAAO,IAAI,OAAJ,CAAY,UAAC,OAAD,EAAU,MAAV,EAAqB;AACpC,YAAI,UAAU,SAAS,KAAT,CAAe,EAAf,EAAmB,UAAC,GAAD,EAAM,KAAN,EAAgB;AAC7C,gBAAI,GAAJ,EAAS;AACL,uBAAO,GAAP,EADK;aAAT,MAGK;AACD,wBAAQ,OAAR,EADC;aAHL;AAMA,eAAG,GAAH,EAAQ,KAAR,EAP6C;SAAhB,CAA7B,CADgC;KAArB,CAAnB,CAFuB;CAA3B;AAcA,QAAQ,KAAR,GAAgB,KAAhB","file":"utils.js","sourcesContent":["\"use strict\";\nconst path = require('path');\nconst fs = require('fs');\nconst _ = require('lodash');\nrequire('babel-polyfill');\nrequire('source-map-support').install();\nconst chai_1 = require('chai');\nexports.expect = chai_1.expect;\nconst webpack = require('webpack');\nconst BPromise = require('bluebird');\nconst mkdirp = BPromise.promisify(require('mkdirp'));\nconst rimraf = BPromise.promisify(require('rimraf'));\nconst readFile = BPromise.promisify(fs.readFile);\nconst writeFile = BPromise.promisify(fs.writeFile);\nconst loaderDir = path.join(process.cwd(), 'dist.babel');\nconst ForkCheckerPlugin = require(loaderDir).ForkCheckerPlugin;\nexports.defaultOutputDir = path.join(process.cwd(), 'src', 'test', 'output');\nexports.defaultFixturesDir = path.join(process.cwd(), 'src', 'test', 'fixtures');\nlet defaultOptions = {\n    loaderParams: '',\n    watch: false,\n    forkChecker: false,\n};\nfunction createConfig(conf, _options = defaultOptions) {\n    let options = _.merge({}, defaultOptions, _options);\n    const defaultConfig = {\n        watch: false,\n        output: {\n            path: exports.defaultOutputDir,\n            filename: '[name].js'\n        },\n        resolve: {\n            extensions: ['', '.ts', '.tsx', '.js', '.jsx'],\n        },\n        module: {\n            loaders: [\n                {\n                    test: /\\.(tsx?|jsx?)/,\n                    loader: loaderDir + '?target=es6' + options.loaderParams,\n                },\n            ],\n        },\n        plugins: []\n    };\n    if (options.include) {\n        defaultConfig.module.loaders[0].include = options.include;\n    }\n    if (options.exclude) {\n        defaultConfig.module.loaders[0].exclude = options.exclude;\n    }\n    if (options.watch) {\n        defaultConfig.watch = true;\n    }\n    if (options.forkChecker) {\n        defaultConfig.plugins.push(new ForkCheckerPlugin());\n    }\n    return _.merge(defaultConfig, conf);\n}\nexports.createConfig = createConfig;\nfunction expectSource(source, fragment) {\n    chai_1.expect(source.replace(/\\s/g, '')).include(fragment.replace(/\\s/g, ''));\n}\nexports.expectSource = expectSource;\nfunction fixturePath(fileName, fixturesDir = exports.defaultFixturesDir) {\n    return path.join.apply(path, [fixturesDir].concat(fileName));\n}\nexports.fixturePath = fixturePath;\nfunction readFixture(fileName, fixturesDir = exports.defaultFixturesDir) {\n    let filePath = fixturePath(fileName, fixturesDir);\n    return readFile(filePath).then(buf => buf.toString());\n}\nexports.readFixture = readFixture;\nfunction writeFixture(fileName, text, fixturesDir = exports.defaultFixturesDir) {\n    let filePath = fixturePath(fileName, fixturesDir);\n    return writeFile(filePath, text);\n}\nexports.writeFixture = writeFixture;\nfunction touchFile(fileName) {\n    return readFile(fileName)\n        .then(buf => buf.toString())\n        .then(source => writeFile(fileName, source));\n}\nexports.touchFile = touchFile;\nfunction outputFileName(fileName, outputDir = exports.defaultOutputDir) {\n    return path.join(exports.defaultOutputDir, fileName);\n}\nexports.outputFileName = outputFileName;\nfunction readOutputFile(fileName, outputDir = exports.defaultOutputDir) {\n    return readFile(outputFileName(fileName || 'main.js', outputDir)).then(buf => buf.toString());\n}\nexports.readOutputFile = readOutputFile;\nfunction cleanOutputDir(outputDir = exports.defaultOutputDir) {\n    return rimraf(outputDir)\n        .then(() => mkdirp(outputDir));\n}\nexports.cleanOutputDir = cleanOutputDir;\nfunction cleanAndCompile(config, outputDir = exports.defaultOutputDir) {\n    return cleanOutputDir(outputDir)\n        .then(() => compile(config));\n}\nexports.cleanAndCompile = cleanAndCompile;\nfunction compile(config) {\n    return new Promise((resolve, reject) => {\n        let compiler = webpack(config);\n        compiler.run((err, stats) => {\n            if (err) {\n                reject(err);\n            }\n            else {\n                resolve(stats);\n            }\n        });\n    });\n}\nexports.compile = compile;\nfunction watch(config, cb) {\n    let compiler = webpack(config);\n    return new Promise((resolve, reject) => {\n        let watcher = compiler.watch({}, (err, stats) => {\n            if (err) {\n                reject(err);\n            }\n            else {\n                resolve(watcher);\n            }\n            cb(err, stats);\n        });\n    });\n}\nexports.watch = watch;\n//# sourceMappingURL=utils.js.map"]}